const { Command } = require('@oclif/command');
const createClient = require('../client');
const { load: loadConfig } = require('../core/config');
const cli = require('cli-ux').default;

class JoinCommand extends Command {
  async run() {
    const config = loadConfig();

    cli.action.start('Connecting to the hub');
    const client = await createClient(config);
    cli.action.stop();

    const token = await cli.prompt('Please introduce the invitation token you have received');
    cli.action.start('Joining the hub');
    await client.joinHub({ username: config.username, token });
    cli.action.stop();

    this.log('Joined successfully');
    client.disconnect();
  }
}

JoinCommand.description = `Join a harpocrates hub for the first time
...
This command allows you to join the harpocrates hub for the first time as a non authenticated member.
In order to join a hub you need an invitation token.
Invitation tokens can be generated by users that are already on a hub by using the command: harpocrates invite
`;

JoinCommand.flags = {
};

module.exports = JoinCommand;
